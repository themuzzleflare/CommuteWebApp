"use strict";window.addEventListener("cloudkitloaded",function(){try{CloudKit.configure({containers:[{containerIdentifier:"iCloud.cloud.tavitian.commute",environment:"production",apnsEnvironment:"production",apiTokenAuth:{apiToken:"4ff6e686d07f5c352890701bcff389ed23a506ddfc27a57b8cb8118f16f82ba4",persist:!0,signInButton:{id:"apple-sign-in-button",theme:"white-with-outline"},signOutButton:{id:"apple-sign-out-button",theme:"white-with-outline"}}}],services:{logger:console}}),setupAuth()}catch(a){ckConfigErrorModal(a).show()}});function setupAuth(){function a(a){displayUsername(a),registerForNotifications(),fetchTrips(),c.whenUserSignsOut().then(b)}function b(d){d&&"AUTH_PERSIST_ERROR"===d.ckErrorCode&&ckConfigErrorModal(d).show(),displayUsername("Unauthenticated User"),searchBarIsVisible(!1),unmountTrips(),c.whenUserSignsIn().then(a).catch(b)}var c=CloudKit.getDefaultContainer();return c.setUpAuth().then(function(c){c?a(c):b()}).catch(function(a){ckConfigErrorModal(a).show()})}function displayUsername(a){var b;if("string"==typeof a)b=a;else{var c=a.nameComponents;b=c?c.givenName+" "+c.familyName:"User record name: "+a.userRecordName}var d=React.createElement("span",{className:"navbar-text px-2"},b);ReactDOM.render(d,document.getElementById("username"))}function registerForNotifications(){var a=CloudKit.getDefaultContainer();return a.isRegisteredForNotifications?CloudKit.Promise.resolve():(a.addNotificationListener(function(a){tripsChangeToast(a)}),a.registerForNotifications().then(function(a){a.isRegisteredForNotifications&&console.log("Container is registered for notifications.")}))}function fetchTrips(a,b){var c=CloudKit.getDefaultContainer(),d=c.privateCloudDatabase,e=void 0,f=void 0,g=[];b&&b.forEach(function(a){g.push(a)}),pageIsLoading(!0),searchBarIsVisible(!1),a?(e=a,f=void 0):(e={recordType:"CD_Trip",sortBy:[{fieldName:"CD_fromName",ascending:!0},{fieldName:"CD_toName",ascending:!0}]},f={zoneID:{zoneName:"com.apple.coredata.cloudkit.zone"},resultsLimit:200,desiredKeys:["CD_id","CD_fromId","CD_fromStopId","CD_fromName","CD_toId","CD_toStopId","CD_toName"],numbersAsStrings:!1}),d.performQuery(e,f).then(function(a){if(a.hasErrors)throw a.errors[0];else a.isQueryResponse&&(a.records.forEach(function(a){g.push(a)}),a.moreComing?fetchTrips(a,g):(renderTrips(g),pageIsLoading(!1),searchBarIsVisible(!0)))}).catch(function(a){pageIsLoading(!1),searchBarIsVisible(!1),showErrorAlert(a)})}function addTripAction(){addTripWorkflow().show(),fetchStations()}function fetchStations(a,b){var c=CloudKit.getDefaultContainer(),d=c.publicCloudDatabase,e=void 0,f=void 0,g=[];b&&b.forEach(function(a){g.push(a)}),a?(e=a,f=void 0):(e={recordType:"Stations",sortBy:[{fieldName:"name",ascending:!0}]},f={resultsLimit:200,numbersAsStrings:!1}),d.performQuery(e,f).then(function(a){if(a.hasErrors)throw a.errors[0];else a.isQueryResponse&&(a.records.forEach(function(a){g.push(a)}),a.moreComing?fetchStations(a,g):renderStations(g))}).catch(function(){})}function refreshTrips(){unmountTrips(),fetchTrips()}function renderStations(a){function b(b){var d=React.createElement("label",{htmlFor:b+"DataList",className:"form-label",key:b+"LabelKey"},c(b)),e=React.createElement("input",{className:"form-control",list:b+"Options",id:b+"DataList",placeholder:"Type to search...",key:b+"InputKey"});return React.createElement("div",{id:b,key:b+"WrapperKey"},[d,e,stationDatalistElement(a,b)])}function c(a){if("fromStation"===a)return"Origin";return"toStation"===a?"Destination":void 0}var d=React.createElement("div",{id:"fromToStationsWrapper",key:"fromToStationsWrapperKey"},[b("fromStation"),b("toStation")]);ReactDOM.render(d,document.getElementById("fromToStations"))}function renderTrips(a){var b=[];a.forEach(function(a){b.push(tripListItemElement(a))});var c=React.createElement("ul",{id:"tripsList",className:"list-group list-group-flush"},b);ReactDOM.render(c,document.getElementById("trips"))}function noTripsElement(){return React.createElement("li",{className:"list-group-item",key:"noTripsKey"},"No trips were found.")}function stationDatalistElement(a,b){var c=[];return a.forEach(function(a){c.push(stationOptionElement(a))}),React.createElement("datalist",{id:b+"Options",key:b+"OptionsKey"},c)}function stationOptionElement(a){var b=a.fields;return React.createElement("option",{id:b.id.value,stopid:b.stopId.value,value:b.name.value,key:a.recordName})}function tripListItemElement(a){var b=a.fields;return React.createElement("li",{id:b.CD_id.value,className:"list-group-item",key:a.recordName},b.CD_fromName.value.split(" Station").join("")+" to "+b.CD_toName.value.split(" Station").join(""))}function searchFunction(){var a,b,c,d,e,f;for(a=document.getElementById("tripsSearch"),b=a.value.toUpperCase(),c=document.getElementById("tripsList"),d=c.getElementsByTagName("li"),e=0;e<d.length;e++)f=d[e].textContent||d[e].innerText,d[e].style.display=-1<f.toUpperCase().indexOf(b)?"":"none"}function showErrorAlert(a){var b=React.createElement("button",{className:"btn-close",type:"button","data-bs-dismiss":"alert","aria-label":"Close",key:"closeButtonKey"}),c=React.createElement("p",{className:"mb-0",key:"messageKey"},a.reason?a.reason:a.message||"An unknown error occurred."),d=React.createElement("h5",{className:"alert-heading",key:"headingKey"},a.ckErrorCode||"Error"),e=React.createElement("div",{className:"alert alert-danger alert-dismissible fade show m-2",role:"alert"},[d,c,b]);ReactDOM.render(e,document.getElementById("alertPlaceholder"))}function pageIsLoading(a){if("boolean"==typeof a)if(a){var b=React.createElement("span",{className:"visually-hidden"},"Loading..."),c=React.createElement("div",{className:"spinner-border m-5",role:"status"},b),d=React.createElement("div",{className:"d-flex justify-content-center"},c);ReactDOM.render(d,document.getElementById("spinner"))}else unmountSpinner()}function unmountSpinner(){ReactDOM.unmountComponentAtNode(document.getElementById("spinner"))}function searchBarIsVisible(a){if("boolean"==typeof a)if(a){var b=React.createElement("button",{className:"btn btn-primary col-1",type:"button",onClick:function a(){return addTripAction()},key:"addButtonKey"},"Add"),c=React.createElement("button",{className:"btn btn-secondary col-1",type:"button",onClick:function a(){return refreshTrips()},key:"refreshButtonKey"},"Refresh"),d=React.createElement("input",{id:"tripsSearch",className:"form-control col",onKeyUp:function a(){return searchFunction()},type:"text",placeholder:"Search Trips",key:"searchKey"}),e=React.createElement("div",{className:"row m-2 gap-2"},[d,c,b]);ReactDOM.render(e,document.getElementById("searchBar"))}else unmountSearchBar()}function unmountTrips(){ReactDOM.unmountComponentAtNode(document.getElementById("trips"))}function unmountSearchBar(){ReactDOM.unmountComponentAtNode(document.getElementById("searchBar"))}function tripsChangeToast(a){var b=React.createElement("div",{className:"toast-body",key:a.notificationID+"-bodyKey"},"A change has been made to your saved trips from another device. Please refresh."),c=React.createElement("strong",{className:"me-auto",key:a.notificationID+"-titleKey"},"Change made to Trips"),d=React.createElement("button",{className:"btn-close",type:"button","data-bs-dismiss":"toast","aria-label":"Close",key:a.notificationID+"-closeButtonKey"}),e=React.createElement("div",{className:"toast-header",key:a.notificationID+"-headerKey"},[c,d]),f=React.createElement("div",{id:a.notificationID,className:"toast",role:"alert","aria-live":"assertive","aria-atomic":"true"},[e,b]);ReactDOM.render(f,document.getElementById("toastPlaceholder"));var g=[].slice.call(document.querySelectorAll(".toast")),h=g.map(function(a){a.addEventListener("hidden.bs.toast",function(){unmountToast()}),new bootstrap.Toast(a).show()})}function unmountToast(){ReactDOM.unmountComponentAtNode(document.getElementById("toastPlaceholder"))}function errorToast(a){var b=document.getElementById("toastPlaceholder"),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("strong"),f=document.createElement("button"),g=document.createElement("div");return c.id=a.uuid||uuidv4(),c.className="toast",c.setAttribute("role","alert"),c.setAttribute("aria-live","assertive"),c.setAttribute("aria-atomic","true"),d.className="toast-header",e.className="me-auto",e.innerText=a.ckErrorCode||"Error",f.className="btn-close",f.setAttribute("type","button"),f.setAttribute("data-bs-dismiss","toast"),f.setAttribute("aria-label","Close"),d.append(e,f),g.className="toast-body",g.innerText=a.reason?a.reason:a.message||"An unknown error occurred.",c.append(d,g),b.append(c),new bootstrap.Toast(document.getElementById(c.id))}function errorModal(a){var b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("h5"),g=document.createElement("button"),h=document.createElement("div"),i=document.createElement("p"),j=document.createElement("div"),k=document.createElement("button"),l=document.createElement("button");return b.id=a.uuid||uuidv4(),b.classList.add("modal"),b.classList.add("fade"),b.setAttribute("tabindex","-1"),b.setAttribute("aria-labelledby","label-"+b.id),b.setAttribute("aria-hidden","true"),c.className="modal-dialog",d.className="modal-content",e.className="modal-header",f.id="label-"+b.id,f.className="modal-title",f.innerText=a.ckErrorCode||"Error",g.className="btn-close",g.setAttribute("type","button"),g.setAttribute("data-bs-dismiss","modal"),g.setAttribute("aria-label","Close"),h.className="modal-body",i.innerText=a.reason?a.reason:a.message||"An unknown error occurred.",j.className="modal-footer",k.classList.add("btn"),k.classList.add("btn-secondary"),k.setAttribute("type","button"),k.setAttribute("data-bs-dismiss","modal"),k.textContent="Close",l.classList.add("btn"),l.classList.add("btn-primary"),l.setAttribute("type","button"),l.onclick=function(){return fetchTrips()},l.setAttribute("data-bs-dismiss","modal"),l.textContent="Retry",j.append(k,l),h.append(i),e.append(f,g),d.append(e,h,j),c.append(d),b.append(c),new bootstrap.Modal(b)}function addTripWorkflow(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("h5"),f=document.createElement("button"),g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("div"),j=document.createElement("button"),k=document.createElement("button");return a.id="addTripModal",a.classList.add("modal"),a.classList.add("fade"),a.setAttribute("tabindex","-1"),a.setAttribute("aria-labelledby","label-"+a.id),a.setAttribute("aria-hidden","true"),b.className="modal-dialog",c.className="modal-content",d.className="modal-header",e.id="label-"+a.id,e.className="modal-title",e.innerText="New Trip",f.className="btn-close",f.setAttribute("type","button"),f.setAttribute("data-bs-dismiss","modal"),f.setAttribute("aria-label","Close"),g.className="modal-body",h.id="fromToStations",i.className="modal-footer",j.classList.add("btn"),j.classList.add("btn-secondary"),j.setAttribute("type","button"),j.setAttribute("data-bs-dismiss","modal"),j.textContent="Cancel",k.classList.add("btn"),k.classList.add("btn-primary"),k.setAttribute("type","button"),k.onclick=function(){return fetchTrips()},k.setAttribute("data-bs-dismiss","modal"),k.textContent="Add",i.append(j,k),g.append(h),d.append(e,f),c.append(d,g,i),b.append(c),a.append(b),a.addEventListener("hidden.bs.modal",function(){var a=document.getElementById("addTripModal"),b=bootstrap.Modal.getInstance(a);b.dispose(),a.remove()}),new bootstrap.Modal(a)}function ckConfigErrorModal(a){var b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("h5"),g=document.createElement("button"),h=document.createElement("div"),i=document.createElement("p"),j=document.createElement("div"),k=document.createElement("button");return b.id=a.uuid||uuidv4(),b.classList.add("modal"),b.classList.add("fade"),b.setAttribute("tabindex","-1"),b.setAttribute("aria-labelledby","label-"+b.id),b.setAttribute("aria-hidden","true"),c.className="modal-dialog",d.className="modal-content",e.className="modal-header",f.id="label-"+b.id,f.className="modal-title",f.innerText=a.ckErrorCode||"Error",g.className="btn-close",g.setAttribute("type","button"),g.setAttribute("data-bs-dismiss","modal"),g.setAttribute("aria-label","Close"),h.className="modal-body",i.innerText=a.reason?a.reason:a.message||"An unknown error occurred.",j.className="modal-footer",k.classList.add("btn"),k.classList.add("btn-secondary"),k.setAttribute("type","button"),k.setAttribute("data-bs-dismiss","modal"),k.textContent="Close",j.append(k),h.append(i),e.append(f,g),d.append(e,h,j),c.append(d),b.append(c),new bootstrap.Modal(b)}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})}